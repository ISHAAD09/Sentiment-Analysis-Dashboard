<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sentiment Analysis Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    /* Base */
    body {
      background: linear-gradient(135deg, #c04fe9, #fce4ec);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 40px;
      color: #333;
    }

    .container { max-width: 1000px; }

    /* Panels & Cards */
    .panel {
      background: #ebd5e5;
      border-radius: 14px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .panel:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }
    .result-card { margin-top: 30px; border-radius: 14px; }

    /* Headers */
    h1 { font-weight: 700; color: #212529; }
    .card-header { font-size: 1.1rem; font-weight: 600; }

    /* Forms */
    textarea, input[type="file"] {
      border-radius: 10px;
      border: 1px solid #ced4da;
      font-size: 0.95rem;
    }
    button.btn-primary {
      border-radius: 30px;
      padding: 10px 24px;
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
    }
    button.btn-primary:hover {
      background-color: #0056b3;
      box-shadow: 0 6px 14px rgba(0, 123, 255, 0.4);
    }

    /* Charts */
    canvas {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    @media (min-width: 992px) {
      .grid-2 { grid-template-columns: 1fr 1fr; }
    }

    /* History List */
    .list-group-item { font-size: 0.9rem; }
    .list-group-item:hover { background: #f8f9fa; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4 text-center">✨ Sentiment Analysis ✨</h1>

    <!-- Input -->
    <div class="panel p-4 mb-4">
      <form method="POST" enctype="multipart/form-data">
        <div class="mb-3">
          <label for="user_text" class="form-label fw-semibold">Enter text</label>
          <textarea class="form-control" id="user_text" name="user_text" rows="4"
            placeholder="Type or paste text here..."></textarea>
        </div>
        <div class="mb-3">
          <label for="file" class="form-label fw-semibold">Or upload a .txt file</label>
          <input type="file" class="form-control" name="file" id="file" accept=".txt" />
        </div>
        <button type="submit" class="btn btn-primary">Analyze</button>
      </form>
    </div>

    {% if result %}
      <!-- Result -->
      <div class="card border-{{ result.color }} result-card shadow-sm">
        <div class="card-header bg-{{ result.color }} text-white">Latest Analysis</div>
        <div class="card-body">
          <p><strong>Sentiment:</strong> <span class="text-{{ result.color }}">{{ result.sentiment }}</span></p>
          <p class="mb-2">
            <strong>Polarity:</strong> {{ result.polarity }} &nbsp; | &nbsp;
            <strong>Subjectivity:</strong> {{ result.subjectivity }}
          </p>
          <details>
            <summary class="mb-2">Show input text</summary>
            <pre class="mt-2" style="white-space: pre-wrap;">{{ result.text }}</pre>
          </details>
        </div>
      </div>

      <!-- Charts + Wordcloud -->
     <div class="grid-2 mt-4">
  <div>
    <canvas id="sentimentChart"></canvas>
  </div>
  <div>
    {% if result.emotion_labels and result.emotion_values and result.emotion_labels|length > 0 %}
      <canvas id="emotionChart"></canvas>
    {% else %}
      <div class="panel p-4 h-100 d-flex align-items-center justify-content-center text-muted">
        <div>No emotion signals detected in this text.</div>
      </div>
    {% endif %}
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Polarity / Subjectivity chart
  new Chart(document.getElementById('sentimentChart'), {
    type: 'bar',
    data: {
      labels: ['Polarity', 'Subjectivity'],
      datasets: [{
        label: 'Sentiment Scores',
        data: [{{ result.polarity }}, {{ result.subjectivity }}],
        backgroundColor: ['rgba(54, 162, 235, 0.6)', 'rgba(255, 159, 64, 0.6)'],
        borderColor: ['rgba(54, 162, 235, 1)', 'rgba(255, 159, 64, 1)'],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true, max: 1, ticks: { stepSize: 0.2 } } }
    }
  });

  // Emotion chart (only if non-empty)
  {% if result.emotion_labels and result.emotion_values and result.emotion_labels|length > 0 %}
    const elabels = {{ result.emotion_labels | tojson }};
    const edata = {{ result.emotion_values | tojson }};
    new Chart(document.getElementById('emotionChart'), {
      type: 'bar',
      data: {
        labels: elabels,
        datasets: [{
          label: 'Emotion Proportions',
          data: edata,
          borderWidth: 1,
          backgroundColor: 'rgba(99, 132, 255, 0.6)',
          borderColor: 'rgba(99, 132, 255, 1)'
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { x: { beginAtZero: true, max: 1, ticks: { stepSize: 0.2 } } }
      }
    });
  {% endif %}
</script>

    {% endif %}
<!-- History -->
{% if history %}
<div class="panel p-0 mt-4">
  <div class="card-header bg-dark text-white">History (last 5)</div>
  <ul class="list-group list-group-flush">
    {% for item in history %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="text-truncate" style="max-width: 600px;">{{ item.text }}</span>
      <span>
        {% if item.primary_emotion %}
          <span class="badge bg-secondary me-2">{{ item.primary_emotion|capitalize }}</span>
        {% endif %}
        <span class="badge bg-{{ item.color }}">{{ item.sentiment }}</span>
      </span>
    </li>
    {% endfor %}
  </ul>
</div>
{% endif %}

  </div>
</body>
</html>
